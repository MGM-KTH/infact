%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Short Sectioned Assignment
% LaTeX Template
% Version 1.0 (5/5/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% Frits Wenneker (http://www.howtotex.com)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[paper=a4, fontsize=11pt,numbers=endperiod]{scrartcl} % A4 paper and 11pt font size

\usepackage[T1]{fontenc} % Use 8-bit encoding that has 256 glyphs
%\usepackage{fourier} % Use the Adobe Utopia font for the document - comment this line today return to the LaTeX default
\usepackage[english]{babel} % English language/hyphenation
\usepackage{amsmath,amsfonts,amsthm} % Math packages

\usepackage[utf8]{inputenc} % Needed to support swedish "åäö" chars
\usepackage{titling} % Used to re-style maketitle

\usepackage{lipsum} % Used for inserting dummy 'Lorem ipsum' text into the template

\usepackage{sectsty} % Allows customizing section commands
\allsectionsfont{\normalfont} % Make all sections the default font

% Local packages:
\usepackage{enumerate}
\usepackage[usenames,dvipsnames]{color}
\usepackage{tabularx}
\usepackage{fancyvrb}
\DefineShortVerb{\|}
\usepackage{hyperref}
\usepackage{url}
\usepackage[parfill]{parskip}   % Sets newlines between paragraphs
\usepackage{algorithm2e} % Used for Pseudocode
\providecommand{\abs}[1]{\lvert#1\rvert} % \abs{x+y} produces |x+y|



\usepackage{fancyhdr} % Custom headers and footers
\pagestyle{fancyplain} % Makes all pages in the document conform to the custom headers and footers

% Header with additional info
% \fancyhead[L]{\small{Gustaf Lindstedt - \href{mailto:glindste@kth.se}{\color{RoyalBlue}\nolinkurl{glindste@kth.se}} - 910301\\Martin Runelöv - \href{mailto:mrunelov@kth.se}{\color{RoyalBlue}\nolinkurl{mrunelov@kth.se}} - 900330-5738}}
% Simple header
\fancyhead[L]{\small{Gustaf Lindstedt\\Martin Runelöv}} % 


\fancyfoot[L]{} % Empty left footer
\fancyfoot[C]{} % Empty center footer
\fancyfoot[R]{\thepage} % Page numbering for right footer
\renewcommand{\headrulewidth}{0pt} % Remove header underlines
\renewcommand{\footrulewidth}{0pt} % Remove footer underlines
\setlength{\headheight}{23.0pt} % Customize the height of the header
\fancyhfoffset[L]{10mm}% slightly less than 0.25in

\numberwithin{equation}{section} % Number equations within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{figure}{section} % Number figures within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{table}{section} % Number tables within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)

\setlength\parindent{0pt} % Removes all indentation from paragraphs - comment this line for an assignment with lots of text


\posttitle{\par\end{center}} % Remove space between author and title
%----------------------------------------------------------------------------------------
%	TITLE SECTION
%----------------------------------------------------------------------------------------

\title{	
\huge Project 1 - Factoring \\ % The assignment title
\vspace{10pt}
\normalfont \normalsize 
\textsc{DD2440 - Advanced algorithms } \\ [25pt] % 
}

\author{\vspace{-20pt} Gustaf Lindstedt - \nolinkurl{glindste@kth.se} - 910301-2135\\\\\\Martin Runelöv - \nolinkurl{mrunelov@kth.se} - 900330-5738}

\date{\vspace{8pt}\normalsize\today} % Today's date or a custom date

\begin{document}

\maketitle % Print the title

%-------------------------------------------------------------------------------
%	SECTION 1
%-------------------------------------------------------------------------------

\section{Introduction}

\subsection{Problem}
A prime number is a positive integer greater than 1 that has no positive integer divisors other 1 and itself. The prime factorization of a positive integer is a list of primes that divides the integer, and their multiplicities. The problem of finding these prime factors is called integer factorization.

The fundamental theorem of arithmetic states that every positive integer (> 1) is either prime or a unique product of prime numbers. In other words, all natural numbers can be factorized.

The purpose of this project is to study and implement factorization algorithms in order to successfully factorize a set of composite numbers, most of which are non-trivial.



%-------------------------------------------------------------------------------
%	SECTION 2
%-------------------------------------------------------------------------------
\section{Method}
\subsection{Algorithms}
\subsubsection{Pollard's Rho}
The first algorithm used was Pollard's rho algorithm (PR).

Pollard's rho algorithm (PR) \cite{pollard} uses two increasing values modulo $N$ to generate numbers with which to find the greatest common divisor for $N$.
The method uses the sequence $x_{i+1} = x^2 + 1 \bmod N$, where $i > 0$, to generate two values, $x_i$ and $x_{2i}$.
The algorithm then runs $gcd(\abs{x_{2i}-x_i})$. If the result is greater than 1, the result is a non-trivial factor of $N$.
\\

This is better than arbitrarily testing random numbers modulo $N$.
First, since if $N$ is composite, at least one divisor $d$ has to be less than or equal to $\sqrt{N}$.
%blablablabla står en del i citerade man kanske kan nämna\cite{csh}. Mm och nånting om pseudo-random med sekvensen och varför det funkar.

Some improvements were made by Richard Brent and Pollard.\cite{brent}
These improvements mostly center around the fact that multiplying consecutive differences $x_{2i}-x_i$ preserves any divisor $d$ of $N$.
% Nånting om cykler
Therefore the computation of a greatest common divisor, which is expensive, can be performed a lot less often.
This can however introduce problems if the product $q$ grows to $q = 0 \bmod N$, since we then get the result $d=N$.
However, this can be countered by not multiplying too many times, and by backtracking to the last $x_i$ and $x_{2i}$ and performing the regular pollard rho procedure if $d=N$.


In the pseudocode below, the pseudo-random generator $f(x)$ is defined as: $x^2+C\, (mod\, N)$, where $C$ is an arbitrary constant which maintains the property\\ $x = y\, (mod\; p) \rightarrow f(x) = f(y)\,(mod\; p)$.\\

\begin{algorithm}[H]
 \SetAlgoLined % For previous releases [?]
 \textbf{Input:} {A composite number N}\\
 \textbf{Output:} {A non-trivial factor of N}\\
 let $x_0 \in_U \mathbb{Z}_N$\\
 $x := x_0$\\
 $y := x_0$\\
 \While{True}{
  $x := f(x)$\;
  $y := f(f(y))$\;
  $d := gcd( \abs{y-x}, N)$\;
  \If{$d > 1$}{
   return d\;
   }
 }
 \caption{Pseudocode for Pollard's rho algorithm}
\end{algorithm}

\hspace{0pt}\\\\

\subsubsection{Fermats Factorization Method}
Fermat's factorization method (FFM) \cite{fermat} is based on the ability to represent an odd integer as the difference of two squares $N = a^2 - b^2$.
Different values of $a$ are tried, searching for an $a$ such that the expression $a^2 - N$, which is equivalent to $b^2$, produces a square.

\begin{algorithm}[H]
 \SetAlgoLined % For previous releases [?]
 \textbf{Input:} {A composite number N}\\
 \textbf{Output:} {A non-trivial factor of N}\\
 $a := ceil(sqrt(N))$\\
 $b2 := a*a - N$\\
 \While{b2 isn't a square}{
  $a := a+1$\;
  $b2 := a*a - N$\;
  }
  return $a-sqrt(b2)$\;
  \hspace{0pt}\\
  \caption{Pseudocode for Fermats Factorization Method taken from wikipedia}
\end{algorithm}

\subsubsection{Quadratic Sieve}
The quadratic sieve (QS) \cite{qsieve}

\subsection{Implementation}
A static list of the first 10 000 primes was used to weed out trivial primes with trial division. When using PR only the first 500-2000 primes are used.
\\
In practice, the $while$-loop runs a finite number of times, since Pollard's rho algorithm can fail to find factors, and since the program has a deadline to keep.
Another paper that describes several algorithms, including Brent (not the version we're using, this one gave $\sim$57 in Kattis. A lot simpler though.)\cite{otherpaper}

The factorization program was written in |C| and uses the library GMP\cite{gmp} to represent large numbers, perform functions such as primality testing and GCD.

Before each iteration of PR, primality testing is performed. This is done using GMP's built-in function |mpz_probab_prime| which uses trial division and Miller-Rabin probabilistic primality tests internally.\cite{probabprime}

%-------------------------------------------------------------------------------
%   SECTION 3
%-------------------------------------------------------------------------------

\section{Results}

The table below shows you how many of the 100 KATTIS numbers that the different algorithms were able to factorize.

    \begin{tabular}{|c|c|c|c|c|}
    \hline
    \textbf{Algorithm} & \textbf{Factorized numbers} \\ \hline
    Trial division & 11 \\ \hline
    Trial division + mpz\_probab\_prime & 19 \\ \hline
    Pollard's rho & 73 \\ \hline
    Brent's & 86 \\ \hline
    \end{tabular}
    \hspace{10pt}

    submission ID for the best submission (86 pts): |453799|

Pollard's rho algorithm got results between 57 and 73, and Brent's factorization method got results between 73 and 86.
In order to avoid going over the time limit of 15 seconds we had to skip numbers above a certain size. Pollard's rho got its best results when we skipped numbers greater than 86 bits. Since Brent's method is faster, we were able to include numbers up to 95 bits without reaching the time limit. 

We also had to set a limit on the number of iterations. This was done using trial-and-error since the number of iterations necessary depends on the numbers to be factored. These iteration limits turned out to be slightly arbitrary once above a certain threshold, which seems to indicate that most if not all numbers were successfully factored. However, one slight modification was made in Brent's method. The number of iterations performed for numbers greater than 90 bits in size were a lot lower than the default limit. This lower limit was set to about 5000, instead of the default of about 100 000. This can be explained by the fact that bigger numbers are more likely to require more iterations, which makes the program waste time by performing many iterations on numbers it will fail to factorize.


\subsection{Discussion}
Given more time, what could have been improved?\\
Were the results expected? Why?\\
Something about PR vs BFM?\\



\begin{thebibliography}{9}

\bibitem{gmp}\url{http://gmplib.org} <insert date here!>
\bibitem{probabprime}\url{http://gmplib.org/manual/Number-Theoretic-Functions.html} <insert date here!>
\bibitem{pollard}\url{http://en.wikipedia.org/wiki/Pollard's_rho_algorithm} <insert date here!>
\bibitem{brent}\url{http://maths-people.anu.edu.au/~brent/pub/pub051.html} <insert date here!>
\bibitem{otherpaper}\url{http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.117.1230&rep=rep1&type=pdf} <insert date here!>
\bibitem{qsieve}\url{http://en.wikipedia.org/wiki/Quadratic_sieve} <insert date here!>
\bibitem{fermat}\url{http://en.wikipedia.org/wiki/Fermat's_factorization_method} <insert date here!>
\bibitem{algnotes}\url{http://www.nada.kth.se/~johanh/algnotes.pdf} <insert date here!>
\bibitem{csh}\url{http://www.csh.rit.edu/~pat/math/quickies/rho/}
\end{thebibliography}

\end{document}
